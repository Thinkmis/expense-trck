<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Expense Tracker ‚Äî Money Guide</title>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#F7ECDD;         /* page background (soft beige) */
    --card:#FDF4E9;       /* card background (very soft cream) */
    --accent:#8b5e3c;     /* dark brown text/accent */
    --accent-2:#c79a6a;   /* light golden brown accent */
    --muted:#7a6b60;      /* muted text */
    --danger:#e06a4a;
    --success:#5aa172;
    --glass: rgba(255,255,255,0.7);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,var(--bg), #fff); color:#2f2722;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    min-height: 100vh;
  }

  /* NAVBAR */
  .navbar{
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    padding:16px 28px; background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));
    position:sticky; top:0; z-index:50; border-bottom:1px solid rgba(120,100,85,0.06);
  }
  .nav-left{display:flex;align-items:center;gap:12px}
  .hamburger{width:44px;height:44px;border-radius:10px;background:var(--card);display:flex;align-items:center;justify-content:center;border:1px solid rgba(120,100,85,0.06);cursor:pointer}
  .hamburger:focus{outline:2px solid rgba(139,94,60,0.18)}
  .brand{font-weight:700;color:var(--accent);font-size:20px;display:flex;align-items:center;gap:10px;}
  .brand-logo{height:36px;border-radius:8px;vertical-align:middle;}
  .nav-right{display:flex;align-items:center;gap:12px}
  .btn{padding:10px 18px;border-radius:10px;font-weight:600;border:none;cursor:pointer;font-size:14px;transition:all 0.2s;}
  .btn-login{background:transparent;color:var(--accent);border:1px solid rgba(139,94,60,0.12)}
  .btn-login:hover{background:rgba(139,94,60,0.05);}
  .btn-sign{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:white;box-shadow:0 4px 12px rgba(139,94,60,0.15);}
  .btn-sign:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(139,94,60,0.2);}
  .btn-danger{background:var(--danger);color:white;}
  .user-menu{display:flex;align-items:center;gap:10px;display:none;}
  .user-avatar{width:36px;height:36px;border-radius:50%;background:var(--accent-2);display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-size:14px;cursor:pointer;}
  .user-name{color:var(--accent);font-weight:600;font-size:14px;}

  /* SLIDE MENU */
  .menu-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.25);display:none;z-index:60}
  .side-menu{position:fixed;left:0;top:0;height:100%;width:320px;background:var(--card);box-shadow: 8px 0 30px rgba(30,20,10,0.12);transform:translateX(-110%);transition:transform .36s;z-index:70;padding:20px}
  .side-menu.open{transform:translateX(0)}
  .side-menu h4{margin:0 0 10px;color:var(--accent)}
  .side-menu ul{list-style:none;padding:0;margin:8px 0 0}
  .side-menu li{padding:8px 6px;border-radius:8px;color:var(--muted);cursor:pointer}
  .side-menu li:hover{background:rgba(120,100,85,0.04);color:var(--accent)}
  .menu-user-info{display:flex;align-items:center;gap:10px;padding:12px;background:rgba(139,94,60,0.05);border-radius:8px;margin-bottom:15px;cursor:pointer;}
  .menu-user-info:hover{background:rgba(139,94,60,0.08);}
  .menu-user-avatar{width:40px;height:40px;border-radius:50%;background:var(--accent-2);display:flex;align-items:center;justify-content:center;color:white;font-weight:600;font-size:16px;}
  .menu-user-text{flex:1;}
  .menu-user-name{font-weight:600;color:var(--accent);font-size:14px;}
  .menu-user-view{font-size:12px;color:var(--muted);}

  /* HERO */
  .hero{display:grid;grid-template-columns:1fr 460px;gap:28px;align-items:center;padding:36px 28px;}
  @media(max-width:980px){ .hero{grid-template-columns:1fr;padding:20px;}}
  .hero-left{max-width:760px}
  .eyebrow{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(199,154,106,0.12);color:var(--accent);font-weight:600;font-size:13px}
  .headline{font-size:38px;margin:18px 0 12px;color:var(--accent);line-height:1.1;}
  .lede{color:var(--muted);font-size:17px;margin-bottom:18px;line-height:1.5;}
  .hero-ctas{display:flex;gap:12px;flex-wrap:wrap}
  .card-hero{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 14px 40px rgba(30,20,10,0.06);border:1px solid rgba(120,100,85,0.04)}

  .hero-right { border-radius:12px; overflow:hidden; box-shadow:0 12px 36px rgba(30,20,10,0.06); }
  .hero-right img{display:block;width:100%;height:100%;object-fit:cover;min-height:260px}

  /* FEATURES */
  .features{padding:24px 28px;display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
  @media(max-width:980px){ .features{grid-template-columns:repeat(2,1fr)} }
  @media(max-width:560px){ .features{grid-template-columns:1fr} }
  .feature{background:var(--card);padding:18px;border-radius:12px;border:1px solid rgba(120,100,85,0.04);display:flex;gap:12px;align-items:flex-start;transition:transform 0.2s;}
  .feature:hover{transform:translateY(-2px);}
  .feature img{width:56px;height:56px;border-radius:10px;object-fit:cover;flex-shrink:0}
  .feature h5{margin:0 0 6px;color:var(--accent);font-size:16px;}
  .feature p{margin:0;color:var(--muted);font-size:14px;line-height:1.4;}

  /* ARTICLES */
  .articles{padding:24px 28px;background:rgba(247,236,221,0.3);}
  .articles-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
  @media(max-width:980px){ .articles-grid{grid-template-columns:repeat(2,1fr)} }
  @media(max-width:560px){ .articles-grid{grid-template-columns:1fr} }
  .article{background:white;border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(20,20,20,0.06);border:1px solid rgba(120,100,85,0.05);transition:transform 0.2s;}
  .article:hover{transform:translateY(-2px);}
  .article img{width:100%;height:160px;object-fit:cover}
  .article .body{padding:12px}
  .article h4{margin:0;color:var(--accent);font-size:16px;}
  .meta{font-size:13px;color:var(--muted);margin-top:6px}

  /* FOOTER */
  footer{padding:24px 28px;color:var(--muted);font-size:14px;border-top:1px solid rgba(120,100,85,0.04);margin-top:20px}

  /* small helpers */
  .muted{color:var(--muted)}
  .pill{display:inline-block;padding:8px 12px;border-radius:999px;background:rgba(139,94,60,0.08);color:var(--accent);font-weight:600}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .center{text-align:center}

  /* forms */
  .form-row{display:flex;gap:12px}
  .form-row input, .form-row select {flex:1}
  input, select {padding:10px;border-radius:8px;border:1px solid rgba(120,100,85,0.08);font-size:14px;width:100%;}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:4px;}

  /* modal */
  .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;align-items:center;justify-content:center;z-index:120}
  .modal{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 20px 60px rgba(20,20,20,0.12);width:420px;max-width:94%;}
  .modal h3{margin:0 0 10px;color:var(--accent)}
  .modal .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  .modal input, .modal select{margin-bottom:10px;}

  .note{font-size:13px;color:var(--muted);margin-top:8px;}

  /* Dashboard Page - Hidden by default */
  .dashboard-page{display:none;padding:20px;max-width:1200px;margin:0 auto;}
  .dashboard-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:15px;border-bottom:1px solid rgba(120,100,85,0.06);}
  .dashboard-title h1{color:var(--accent);margin:0;}
  .dashboard-title p{margin:5px 0 0;color:var(--muted);}
  .back-home-btn{padding:8px 16px;background:transparent;border:1px solid rgba(139,94,60,0.12);border-radius:8px;color:var(--accent);font-weight:600;cursor:pointer;}
  
  /* Dashboard Tabs */
  .dashboard-tabs{display:flex;gap:5px;background:rgba(139,94,60,0.05);padding:5px;border-radius:10px;margin-bottom:20px;}
  .tab-btn{padding:12px 20px;border:none;background:none;color:var(--muted);font-weight:600;cursor:pointer;border-radius:8px;flex:1;}
  .tab-btn.active{background:white;color:var(--accent);box-shadow:0 2px 8px rgba(139,94,60,0.1);}
  
  /* Dashboard Content */
  .dashboard-content{display:none;}
  .dashboard-content.active{display:block;}
  
  /* Stats Cards */
  .stats-grid{display:grid;grid-template-columns:repeat(4, 1fr);gap:15px;margin-bottom:30px;}
  @media(max-width:768px){.stats-grid{grid-template-columns:repeat(2, 1fr);}}
  .stat-card{background:var(--card);padding:20px;border-radius:12px;text-align:center;box-shadow:0 10px 30px rgba(30,20,10,0.06);border:1px solid rgba(120,100,85,0.04);}
  .stat-number{font-size:28px;font-weight:700;color:var(--accent);margin:10px 0;}
  .stat-desc{color:var(--muted);font-size:14px;}
  
  /* Expense Form Container */
  .expense-form-container{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(30,20,10,0.06);border:1px solid rgba(120,100,85,0.04);margin-bottom:20px;}
  .form-group{margin-bottom:15px;}
  .form-control{width:100%;padding:10px;border:1px solid rgba(120,100,85,0.12);border-radius:8px;font-size:14px;background:white;color:#2f2722;}
  
  /* Recent Expenses */
  .recent-expenses{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(30,20,10,0.06);border:1px solid rgba(120,100,85,0.04);}
  .expense-item{display:flex;justify-content:space-between;align-items:center;padding:12px;background:white;border-radius:8px;margin-bottom:8px;border:1px solid rgba(120,100,85,0.05);}
  .expense-category{background:rgba(199,154,106,0.12);padding:4px 8px;border-radius:6px;font-size:12px;color:var(--accent);}
  .expense-amount{font-weight:600;color:var(--accent);}
  
  /* Charts */
  .chart-container{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(30,20,10,0.06);border:1px solid rgba(120,100,85,0.04);margin-bottom:20px;}
  .chart-tabs{display:flex;gap:5px;margin-bottom:20px;}
  .chart-tab{padding:8px 15px;border:none;background:none;color:var(--muted);font-weight:600;cursor:pointer;border-radius:6px;}
  .chart-tab.active{background:rgba(139,94,60,0.1);color:var(--accent);}
  .chart-canvas{height:300px;width:100%;}
  
  /* Challenges */
  .challenges-container{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(30,20,10,0.06);border:1px solid rgba(120,100,85,0.04);}
  .challenge-item{padding:12px;background:white;border-radius:8px;margin-bottom:10px;border:1px solid rgba(120,100,85,0.05);display:flex;align-items:center;gap:10px;}
  .challenge-icon{width:24px;height:24px;border-radius:50%;background:rgba(139,94,60,0.1);display:flex;align-items:center;justify-content:center;color:var(--accent);}
  
  /* Profile */
  .profile-container{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(30,20,10,0.06);border:1px solid rgba(120,100,85,0.04);}
  .profile-header{display:flex;align-items:center;gap:15px;margin-bottom:20px;}
  .profile-avatar{width:60px;height:60px;border-radius:50%;background:var(--accent-2);display:flex;align-items:center;justify-content:center;color:white;font-size:24px;font-weight:600;}
  .profile-info{flex:1;}
  .profile-name{font-weight:700;color:var(--accent);font-size:18px;}
  .profile-email{color:var(--muted);font-size:14px;}
  .profile-details{display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:15px;}
  .profile-field label{color:var(--muted);font-size:12px;margin-bottom:5px;}
  .profile-field div{color:var(--accent);font-weight:500;}
  
  /* End Day Celebration Animation */
  .falling-item{
    position: fixed;
    top: -50px;
    z-index: 1000;
    font-size: 24px;
    pointer-events: none;
    user-select: none;
    animation: fall linear forwards;
  }
  
  @keyframes fall {
    to {
      transform: translateY(100vh) rotate(360deg);
    }
  }
  
  /* Confetti Animation */
  .confetti {
    position: fixed;
    pointer-events: none;
    z-index: 1000;
    animation: confettiFall linear forwards;
  }
  
  @keyframes confettiFall {
    to {
      transform: translateY(100vh) rotate(360deg);
      opacity: 0;
    }
  }
  
  /* Notification */
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 20px;
    border-radius: 8px;
    background: var(--success);
    color: white;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
  }
  
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
  }

  /* DAY SELECTOR */
  .day-selector {
    background: var(--card);
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 10px 30px rgba(30,20,10,0.06);
    border: 1px solid rgba(120,100,85,0.04);
  }
  
  .day-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  
  .day-nav h3 {
    margin: 0;
    color: var(--accent);
    font-size: 18px;
  }
  
  .nav-buttons {
    display: flex;
    gap: 10px;
  }
  
  .day-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-top: 15px;
  }
  
  .day-stat {
    text-align: center;
    padding: 10px;
    background: white;
    border-radius: 8px;
    border: 1px solid rgba(120,100,85,0.05);
  }
  
  .day-stat-value {
    font-weight: 600;
    color: var(--accent);
    font-size: 16px;
    margin: 5px 0;
  }
  
  .day-stat-label {
    font-size: 12px;
    color: var(--muted);
  }
  
  /* DATA MANAGEMENT */
  .data-management {
    background: var(--card);
    padding: 20px;
    border-radius: 12px;
    margin-top: 20px;
    box-shadow: 0 10px 30px rgba(30,20,10,0.06);
    border: 1px solid rgba(120,100,85,0.04);
  }
  
  .data-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 15px;
  }
  
  .backup-warning {
    background: rgba(224, 106, 74, 0.1);
    border-left: 4px solid var(--danger);
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
    font-size: 14px;
    color: var(--muted);
  }
  
  /* MONTHLY CATEGORY CHART */
  .category-chart-container {
    background: var(--card);
    padding: 20px;
    border-radius: 12px;
    margin-top: 20px;
    box-shadow: 0 10px 30px rgba(30,20,10,0.06);
    border: 1px solid rgba(120,100,85,0.04);
  }
  
  .category-chart-canvas {
    height: 400px;
    width: 100%;
  }
  
  /* DAY HISTORY */
  .day-history {
    background: var(--card);
    padding: 20px;
    border-radius: 12px;
    margin-top: 20px;
    box-shadow: 0 10px 30px rgba(30,20,10,0.06);
    border: 1px solid rgba(120,100,85,0.04);
  }
  
  .day-history-list {
    max-height: 300px;
    overflow-y: auto;
    margin-top: 15px;
  }
  
  .history-day {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid rgba(120,100,85,0.05);
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .history-day:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(139,94,60,0.1);
  }
  
  .history-day-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .history-day-date {
    font-weight: 600;
    color: var(--accent);
  }
  
  .history-day-total {
    font-weight: 600;
    color: var(--accent);
  }
  
  .history-day-expenses {
    font-size: 12px;
    color: var(--muted);
  }
  
  /* CATEGORY SUMMARY */
  .category-summary {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }
  
  .category-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid rgba(120,100,85,0.05);
  }
  
  .category-name {
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 5px;
  }
  
  .category-amount {
    font-size: 18px;
    font-weight: 700;
    color: var(--accent);
    margin: 5px 0;
  }
  
  .category-count {
    font-size: 12px;
    color: var(--muted);
  }
  
  .category-percentage {
    height: 6px;
    background: rgba(139,94,60,0.2);
    border-radius: 3px;
    margin-top: 8px;
    overflow: hidden;
  }
  
  .category-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    border-radius: 3px;
  }
</style>
</head>
<body>

<!-- NAVBAR -->
<header class="navbar" role="banner">
  <div class="nav-left">
    <button class="hamburger" id="hamburger" aria-label="Open menu" title="Menu">
      <svg width="20" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="20" height="2" rx="1" fill="#8b5e3c"/>
        <rect y="6" width="20" height="2" rx="1" fill="#8b5e3c"/>
        <rect y="12" width="20" height="2" rx="1" fill="#8b5e3c"/>
      </svg>
    </button>

    <div class="brand" aria-hidden="true">
      <img src="https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?q=80&w=100&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Expense Tracker Logo" class="brand-logo">
      Expense Tracker
    </div>
  </div>

  <div class="nav-right">
    <!-- Login/Signup buttons (shown when logged out) -->
    <div class="auth-buttons" id="authButtons">
      <button class="btn btn-login" id="btnLoginTop">Login</button>
      <button class="btn btn-sign" id="btnSignTop">Sign up</button>
    </div>
    
    <!-- User menu (shown when logged in) -->
    <div class="user-menu" id="userMenu">
      <div class="user-avatar" id="userAvatar" title="View Dashboard">U</div>
      <button class="btn btn-danger" id="logoutBtnNav" style="display:none; padding: 8px 16px;">Logout</button>
    </div>
    
    <nav aria-label="Primary">
      <a class="pill" href="#features">Resources</a>
    </nav>
  </div>
</header>

<!-- Slide-out menu -->
<div class="menu-backdrop" id="menuBackdrop"></div>
<aside class="side-menu" id="sideMenu" aria-hidden="true">
  <!-- User info section (shown when logged in) -->
  <div class="menu-user-info" id="menuUserInfo" style="display:none;">
    <div class="menu-user-avatar" id="menuUserAvatar">U</div>
    <div class="menu-user-text">
      <div class="menu-user-name" id="menuUserName">User Name</div>
      <div class="menu-user-view">View Dashboard ‚Üí</div>
    </div>
  </div>
  
  <h4>Explore</h4>
  <ul>
    <li onclick="scrollToSection('features')">Banking & Budgeting</li>
    <li onclick="scrollToSection('savings')">Budget Planning</li>
    <li onclick="scrollToSection('invest')">Investment Planning</li>
    <li onclick="scrollToSection('safety')">Scams & Online Safety</li>
    <li onclick="scrollToSection('insurance')">Insurance</li>
    <li onclick="scrollToSection('manage')">Manage Your Money</li>
    <li onclick="scrollToSection('articles')">Articles & Guides</li>
  </ul>

  <hr style="margin:12px 0;border:none;border-top:1px solid rgba(120,100,85,0.04)">

  <div style="display:flex;gap:8px" id="menuAuthButtons">
    <button class="btn-sign" style="flex:1" id="menuSign">Create account</button>
    <button class="btn btn-login" style="flex:1" id="menuLogin">Login</button>
  </div>

  <p style="margin-top:14px" class="note">Quick links & helpful resources to guide students and new earners.</p>
</aside>

<!-- HOMEPAGE CONTENT (shown by default) -->
<main id="homepageContent">
  <!-- HERO -->
  <section class="hero" role="region" aria-label="Hero">
    <div class="hero-left">
      <span class="eyebrow">Money help ‚Ä¢ Student friendly</span>
      <h1 class="headline">Master Your Money, Build Your Future</h1>
      <p class="lede">Expense Tracker helps students and new earners track expenses, plan budgets, and learn simple investing. Start your journey to financial independence today with our practical, friendly tools.</p>

      <div class="hero-ctas">
        <button class="btn btn-sign" id="ctaSign">Get Started ‚Äî It's Free</button>
        <button class="btn btn-login" id="ctaLearn">Learn More</button>
      </div>

      <div style="margin-top:18px" aria-hidden="true">
        <div style="display:flex;gap:12px;margin-top:14px">
          <div class="card-hero" style="flex:1">
            <strong style="display:block;color:var(--accent)">Weekly spending</strong>
            <div class="muted" style="margin-top:6px">See where your money goes and set a simple weekly budget.</div>
          </div>
          <div class="card-hero" style="flex:1">
            <strong style="display:block;color:var(--accent)">Save goals</strong>
            <div class="muted" style="margin-top:6px">Create small, realistic saving goals for the month.</div>
          </div>
        </div>
      </div>
    </div>

    <div class="hero-right" aria-hidden="true">
      <img src="https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Financial dashboard showing budget tracking and expense management on laptop">
    </div>
  </section>

  <!-- FEATURES -->
  <section id="features" class="features" role="region" aria-label="Features">
    <div class="feature">
      <img src="https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Budgeting illustration">
      <div>
        <h5>Smart Budgeting</h5>
        <p>Simple steps to track weekly spending and set realistic budgets using our easy tracker. Perfect for student life.</p>
      </div>
    </div>

    <div class="feature">
      <img src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Saving illustration">
      <div>
        <h5>Micro-Saving</h5>
        <p>Start with small goals, build momentum, and celebrate progress. Designed specifically for student budgets.</p>
      </div>
    </div>

    <div class="feature">
      <img src="https://images.unsplash.com/photo-1579621970795-87facc2f976d?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Investing illustration">
      <div>
        <h5>Beginner Investing</h5>
        <p>Learn how to grow your money safely with beginner-friendly concepts explained simply. No prior knowledge needed.</p>
      </div>
    </div>

    <div class="feature">
      <img src="https://images.unsplash.com/photo-1560472354-b33ff0c44a43?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Online safety illustration">
      <div>
        <h5>Online Safety</h5>
        <p>Simple rules to stay safe online: spotting scams, protecting your accounts, and avoiding common fraud tactics.</p>
      </div>
    </div>

    <div class="feature">
      <img src="https://images.unsplash.com/photo-1554224155-6726b3ff858f?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Insurance illustration">
      <div>
        <h5>Insurance Basics</h5>
        <p>Understand basic insurance terms and what matters for students and young adults. Make informed decisions.</p>
      </div>
    </div>

    <div class="feature">
      <img src="https://images.unsplash.com/photo-1460925895917-afdab827c52f?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Tools illustration">
      <div>
        <h5>Practical Tools</h5>
        <p>Calculators, templates and motivational ideas to help form better money habits. All in one place.</p>
      </div>
    </div>
  </section>

  <!-- TESTIMONIAL -->
  <section style="background:var(--card);padding:30px;border-radius:12px;margin:30px 28px;text-align:center;">
    <div style="font-size:18px;color:var(--accent);font-style:italic;margin-bottom:15px;">
      "Expense Tracker helped me save 30% of my monthly allowance as a student. The simple tracking made all the difference!"
    </div>
    <div style="color:var(--muted);font-size:14px;">‚Äî Sarah, University Student</div>
  </section>

  <!-- ARTICLES -->
  <section id="articles" class="articles" role="region" aria-label="Articles">
    <h3 style="margin:0 0 12px;color:var(--accent);font-size:24px;">Guides & Articles</h3>
    <div class="articles-grid">
      <article class="article">
        <img src="https://images.unsplash.com/photo-1554224155-6726b3ff858f?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Student budgeting">
        <div class="body">
          <h4>5 Student Budget Hacks That Actually Work</h4>
          <div class="meta">Budgeting ‚Ä¢ 4 min read</div>
          <p class="note" style="margin-top:8px">Little changes ‚Äî like packing lunch or tracking transport ‚Äî can save more than you think. Try one this week.</p>
        </div>
      </article>

      <article class="article">
        <img src="https://images.unsplash.com/photo-1579621970795-87facc2f976d?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Investing basics">
        <div class="body">
          <h4>Beginner Guide: Investing for Young Adults</h4>
          <div class="meta">Investing ‚Ä¢ 6 min read</div>
          <p class="note" style="margin-top:8px">A friendly intro to how to grow your money without taking unnecessary risks. Start with just ‡ß≥500.</p>
        </div>
      </article>

      <article class="article">
        <img src="https://images.unsplash.com/photo-1560472354-b33ff0c44a43?q=80&w=1200&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Online safety">
        <div class="body">
          <h4>How to Spot Online Scams ‚Äî Quick Checklist</h4>
          <div class="meta">Safety ‚Ä¢ 3 min read</div>
          <p class="note" style="margin-top:8px">Never give out passwords or OTPs. This short checklist helps you stay safe online and protect your money.</p>
        </div>
      </article>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div style="display:flex;justify-content:space-between;gap:20px;flex-wrap:wrap;align-items:center">
      <div>
        <strong style="color:var(--accent)">Expense Tracker</strong>
        <div class="muted">Practical money tips & simple tools for students.</div>
      </div>
      <div class="muted">¬© <span id="year"></span> Expense Tracker ‚Ä¢ All rights reserved</div>
    </div>
  </footer>
</main>

<!-- DASHBOARD PAGE (hidden by default) -->
<div class="dashboard-page" id="dashboardPage">
  <div class="dashboard-header">
    <div class="dashboard-title">
      <h1>Expense Tracker Dashboard</h1>
      <p>Welcome back, <span id="dashboardUserName">User</span>! Track your daily expenses</p>
    </div>
    <button class="back-home-btn" id="backToHomeBtn">‚Üê Back to Home</button>
  </div>

  <!-- Dashboard Tabs -->
  <div class="dashboard-tabs">
    <button class="tab-btn active" data-tab="addExpense">Add Expense</button>
    <button class="tab-btn" data-tab="graphs">Graphs & Analysis</button>
    <button class="tab-btn" data-tab="profile">Your Profile</button>
    <button class="tab-btn" data-tab="challenges">Challenges</button>
  </div>

  <!-- Add Expense Tab -->
  <div class="dashboard-content active" id="addExpenseTab">
    <!-- Day Selector -->
    <div class="day-selector">
      <div class="day-nav">
        <h3 id="currentDayDisplay">Today, January 15, 2024</h3>
        <div class="nav-buttons">
          <button class="btn btn-login" id="prevDayBtn">‚Üê Previous</button>
          <button class="btn btn-sign" id="nextDayBtn">Next ‚Üí</button>
        </div>
      </div>
      <div class="day-stats">
        <div class="day-stat">
          <div class="day-stat-value" id="dayTotal">‡ß≥0.00</div>
          <div class="day-stat-label">Today's Total</div>
        </div>
        <div class="day-stat">
          <div class="day-stat-value" id="dayEntries">0</div>
          <div class="day-stat-label">Entries</div>
        </div>
        <div class="day-stat">
          <div class="day-stat-value" id="dayTopCategory">-</div>
          <div class="day-stat-label">Top Category</div>
        </div>
        <div class="day-stat">
          <div class="day-stat-value" id="dayAvgAmount">‡ß≥0.00</div>
          <div class="day-stat-label">Avg/Entry</div>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="todayTotal">‡ß≥0.00</div>
        <div class="stat-desc">Today's Total</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="monthlyTotal">‡ß≥0.00</div>
        <div class="stat-desc">This Month</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="totalEntries">0</div>
        <div class="stat-desc">Total Entries</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="avgDaily">‡ß≥0.00</div>
        <div class="stat-desc">Avg Daily</div>
      </div>
    </div>

    <!-- Expense Form -->
    <div class="expense-form-container">
      <h3>Add New Expense for <span id="formDayDisplay">Today</span></h3>
      <div class="form-group">
        <label for="category">Category</label>
        <select id="category" class="form-control">
          <option value="Food">Food</option>
          <option value="Transport">Transport</option>
          <option value="Shopping">Shopping</option>
          <option value="Bills">Bills</option>
          <option value="Education">Education</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Healthcare">Healthcare</option>
          <option value="Other">Other</option>
        </select>
      </div>
      
      <div id="customCategoryGroup" class="form-group" style="display:none;">
        <label for="customCategory">Custom Category</label>
        <input type="text" id="customCategory" class="form-control" placeholder="Enter custom category">
      </div>
      
      <div class="form-group">
        <label for="description">Description</label>
        <input type="text" id="description" class="form-control" placeholder="e.g., Lunch at canteen, Bus fare">
      </div>
      
      <div class="form-group">
        <label for="amount">Amount (‡ß≥)</label>
        <input type="number" id="amount" class="form-control" placeholder="0.00" min="0" step="0.01">
      </div>
      
      <div style="display:flex; gap:10px; margin-top:20px;">
        <button class="btn btn-sign" id="addExpenseBtn" style="flex:1;">Add Expense</button>
        <button class="btn btn-login" id="clearDayBtn" style="flex:1;">Clear This Day</button>
      </div>
      
      <!-- End Day Button -->
      <div style="margin-top:15px;">
        <button class="btn" id="endDayBtn" style="width:100%; background:linear-gradient(180deg, var(--accent-2), var(--accent)); color:white; padding:12px;">End Day & Archive</button>
      </div>
    </div>

    <!-- Recent Expenses -->
    <div class="recent-expenses">
      <h3>Expenses for <span id="listDayDisplay">Today</span></h3>
      <div id="recentExpensesList">
        <p style="color:var(--muted); text-align:center; padding:20px;">No expenses recorded yet</p>
      </div>
    </div>

    <!-- Day History -->
    <div class="day-history">
      <h3>Previous Days</h3>
      <div class="day-history-list" id="dayHistoryList">
        <p style="color:var(--muted); text-align:center; padding:20px;">No previous days recorded</p>
      </div>
    </div>
  </div>

  <!-- Graphs Tab -->
  <div class="dashboard-content" id="graphsTab">
    <!-- Monthly Category Chart -->
    <div class="category-chart-container">
      <h3>Monthly Spending by Category</h3>
      <canvas id="categoryChart" class="category-chart-canvas"></canvas>
    </div>
    
    <!-- Category Summary -->
    <div class="recent-expenses">
      <h3>Category Breakdown for <span id="currentMonthDisplay">January 2024</span></h3>
      <div class="category-summary" id="categorySummary">
        <p style="color:var(--muted); text-align:center; padding:20px;">No expense data available</p>
      </div>
    </div>
    
    <!-- Line Charts Container -->
    <div class="chart-container">
      <div class="chart-tabs">
        <button class="chart-tab active" data-period="weekly">Weekly</button>
        <button class="chart-tab" data-period="monthly">Monthly</button>
        <button class="chart-tab" data-period="yearly">Yearly</button>
      </div>
      <canvas id="expenseChart" class="chart-canvas"></canvas>
    </div>
    
    <!-- Data Management -->
    <div class="data-management">
      <h3>Data Management</h3>
      <p class="note">Export your data to prevent loss. Data is stored locally in your browser.</p>
      
      <div class="data-actions">
        <button class="btn btn-sign" id="exportDataBtn">Export All Data</button>
        <button class="btn btn-login" id="importDataBtn">Import Data</button>
        <button class="btn btn-danger" id="clearAllDataBtn">Clear All Data</button>
      </div>
      
      <div class="backup-warning">
        <strong>‚ö†Ô∏è Important:</strong> Your data is stored in your browser's local storage. Clearing browser data will delete all your expenses. Export regularly to backup!
      </div>
    </div>
  </div>

  <!-- Profile Tab -->
  <div class="dashboard-content" id="profileTab">
    <div class="profile-container">
      <div class="profile-header">
        <div class="profile-avatar" id="profileAvatar">U</div>
        <div class="profile-info">
          <div class="profile-name" id="profileName">User Name</div>
          <div class="profile-email" id="profileEmail">user@example.com</div>
        </div>
      </div>
      
      <div class="profile-details">
        <div class="profile-field">
          <label>Profession</label>
          <div id="profileProfession">Student</div>
        </div>
        <div class="profile-field">
          <label>Age</label>
          <div id="profileAge">-</div>
        </div>
        <div class="profile-field">
          <label>City</label>
          <div id="profileCity">-</div>
        </div>
        <div class="profile-field">
          <label>Phone</label>
          <div id="profilePhone">-</div>
        </div>
        <div class="profile-field">
          <label>Member Since</label>
          <div id="profileJoinDate">-</div>
        </div>
        <div class="profile-field">
          <label>Total Expenses</label>
          <div id="profileTotalExpenses">0 entries</div>
        </div>
        <div class="profile-field">
          <label>Total Spent</label>
          <div id="profileTotalSpent">‡ß≥0.00</div>
        </div>
        <div class="profile-field">
          <label>Days Tracked</label>
          <div id="profileDaysTracked">0 days</div>
        </div>
        <div class="profile-field">
          <label>Favorite Category</label>
          <div id="profileFavoriteCategory">-</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Challenges Tab -->
  <div class="dashboard-content" id="challengesTab">
    <div class="challenges-container">
      <h3>Money Challenges</h3>
      <div class="challenge-item">
        <div class="challenge-icon">üí∏</div>
        <div>
          <div style="font-weight:600; color:var(--accent);">Save 20% of your income this month</div>
          <div style="font-size:12px; color:var(--muted);">Track your savings progress</div>
        </div>
      </div>
      <div class="challenge-item">
        <div class="challenge-icon">üìä</div>
        <div>
          <div style="font-weight:600; color:var(--accent);">Limit daily spending to ‡ß≥50</div>
          <div style="font-size:12px; color:var(--muted);">Daily expense challenge</div>
        </div>
      </div>
      <div class="challenge-item">
        <div class="challenge-icon">üìù</div>
        <div>
          <div style="font-weight:600; color:var(--accent);">Track all expenses for a week</div>
          <div style="font-size:12px; color:var(--muted);">Consistency challenge</div>
        </div>
      </div>
      <div class="challenge-item">
        <div class="challenge-icon">üèÜ</div>
        <div>
          <div style="font-weight:600; color:var(--accent);">No eating out for 7 days</div>
          <div style="font-size:12px; color:var(--muted);">Food expense challenge</div>
        </div>
      </div>
      <div class="challenge-item">
        <div class="challenge-icon">üí∞</div>
        <div>
          <div style="font-weight:600; color:var(--accent);">Save ‡ß≥500 this week</div>
          <div style="font-size:12px; color:var(--muted);">Weekly savings goal</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Login Modal -->
<div class="modal-back" id="modalBack">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <h3 id="loginTitle">Login to Expense Tracker</h3>
    <label>Email or username</label>
    <input id="loginModalEmail" type="text" placeholder="Email or username">
    <label style="margin-top:8px">Password</label>
    <input id="loginModalPass" type="password" placeholder="Password">
    <div class="actions">
      <button class="btn-sign" id="loginSubmit">Login</button>
      <button id="loginCancel" class="btn-login">Cancel</button>
    </div>
    <p class="note" style="margin-top:10px">Demo: Accounts are saved locally on your device only.</p>
  </div>
</div>

<!-- Register Modal -->
<div class="modal-back" id="modalBackReg">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="regTitle">
    <h3 id="regTitle">Create Your Account</h3>
    <label>Full name</label>
    <input id="reg_name" type="text" placeholder="Your full name">
    <label style="margin-top:8px">Email</label>
    <input id="reg_email" type="email" placeholder="you@example.com">
    <div class="form-row" style="margin-top:8px">
      <div><label>Profession</label><input id="reg_prof" type="text" placeholder="e.g., Student"></div>
      <div><label>Age</label><input id="reg_age" type="number" placeholder="Age" min="12" max="120"></div>
    </div>
    <label style="margin-top:8px">City / Location</label>
    <input id="reg_city" type="text" placeholder="City">
    <label style="margin-top:8px">Phone</label>
    <input id="reg_phone" type="text" placeholder="+8801XXXXXXXXX">
    <label style="margin-top:8px">Set a password</label>
    <input id="reg_pass" type="password" placeholder="Create a password (min 4)">
    <div class="actions">
      <button class="btn-sign" id="regSubmit">Create account</button>
      <button id="regCancel" class="btn-login">Cancel</button>
    </div>
    <p class="note" style="margin-top:8px">Your registration is saved locally for demo purposes only.</p>
  </div>
</div>

<!-- Import Data Modal -->
<div class="modal-back" id="importModalBack">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="importTitle">
    <h3 id="importTitle">Import Data</h3>
    <p class="note">Warning: This will replace all existing data. Export current data first!</p>
    <input type="file" id="importFile" accept=".json" style="margin: 15px 0;">
    <div class="actions">
      <button class="btn-sign" id="importSubmit">Import</button>
      <button id="importCancel" class="btn-login">Cancel</button>
    </div>
  </div>
</div>

<!-- Confetti Container -->
<div id="confettiContainer"></div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // small helpers
  const $ = id => document.getElementById(id);
  document.getElementById('year').textContent = new Date().getFullYear();

  // MENU logic
  const hamburger = $('hamburger'), sideMenu = $('sideMenu'), menuBackdrop = $('menuBackdrop');
  function openMenu(){ sideMenu.classList.add('open'); menuBackdrop.style.display='block'; sideMenu.setAttribute('aria-hidden','false'); }
  function closeMenu(){ sideMenu.classList.remove('open'); menuBackdrop.style.display='none'; sideMenu.setAttribute('aria-hidden','true'); }
  hamburger.addEventListener('click', openMenu); menuBackdrop.addEventListener('click', closeMenu);

  function scrollToSection(id){
    const el = document.getElementById(id);
    if (el) { 
      el.scrollIntoView({behavior:'smooth', block:'start'}); 
      closeMenu(); 
    }
  }

  // MODAL logic
  const modalBack = $('modalBack'), modalBackReg = $('modalBackReg'), importModalBack = $('importModalBack');
  function openLogin(){ modalBack.style.display='flex'; $('loginModalEmail').focus(); }
  function closeLogin(){ modalBack.style.display='none'; }
  function openRegister(){ modalBackReg.style.display='flex'; $('reg_name').focus(); }
  function closeRegister(){ modalBackReg.style.display='none'; }
  function openImport(){ importModalBack.style.display='flex'; }
  function closeImport(){ importModalBack.style.display='none'; }

  // Event listeners for buttons
  $('btnLoginTop').addEventListener('click', openLogin);
  $('btnSignTop').addEventListener('click', openRegister);
  $('ctaSign').addEventListener('click', openRegister);
  $('ctaLearn').addEventListener('click', () => scrollToSection('features'));
  
  // Cancel handlers
  $('loginCancel').addEventListener('click', closeLogin);
  $('regCancel').addEventListener('click', closeRegister);
  $('importCancel').addEventListener('click', closeImport);

  // =============================================
  // ENHANCED DATA STORAGE SYSTEM
  // =============================================

  // Local storage keys
  const USERS_KEY = 'expense_Tracker_users_v2';
  const EXPENSES_KEY = 'expense_Tracker_expenses_v2';
  const SESSION_KEY = 'expense_Tracker_session_v2';
  const ARCHIVED_DAYS_KEY = 'expense_Tracker_archived_days_v2';
  const LAST_BACKUP_KEY = 'expense_Tracker_last_backup_v2';
  
  // Current user and chart instances
  let currentUser = null;
  let expenseChart = null;
  let categoryChart = null;
  let currentViewingDate = new Date(); // Date currently being viewed
  
  // Get today's date string
  function getDateString(date = new Date()) {
    const d = new Date(date);
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${y}-${m}-${day}`;
  }
  
  // Format date for display
  function formatDateDisplay(dateString) {
    const date = new Date(dateString + 'T00:00:00');
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('en-US', options);
  }
  
  // Format month display
  function formatMonthDisplay(date = new Date()) {
    const d = new Date(date);
    return d.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
  }
  
  // Get month string (YYYY-MM)
  function getMonthString(date = new Date()) {
    const d = new Date(date);
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, '0');
    return `${y}-${m}`;
  }
  
  // =============================================
  // ENHANCED STORAGE FUNCTIONS WITH BACKUP
  // =============================================
  
  // Helper functions with error handling and backup
  function usersRead(){ 
    try { 
      const data = localStorage.getItem(USERS_KEY);
      if (!data) return [];
      return JSON.parse(data); 
    } catch(e) { 
      console.error('Error reading users:', e);
      return []; 
    } 
  }
  
  function usersWrite(u){ 
    try {
      localStorage.setItem(USERS_KEY, JSON.stringify(u));
      // Auto-backup every 10 saves
      const lastBackup = localStorage.getItem(LAST_BACKUP_KEY);
      const now = Date.now();
      if (!lastBackup || (now - parseInt(lastBackup)) > 10000) {
        createAutoBackup();
      }
    } catch(e) {
      console.error('Error writing users:', e);
    }
  }
  
  function expensesRead(){ 
    try { 
      const data = localStorage.getItem(EXPENSES_KEY);
      if (!data) return [];
      return JSON.parse(data); 
    } catch(e) { 
      console.error('Error reading expenses:', e);
      return []; 
    } 
  }
  
  function expensesWrite(e){ 
    try {
      localStorage.setItem(EXPENSES_KEY, JSON.stringify(e));
    } catch(e) {
      console.error('Error writing expenses:', e);
    }
  }
  
  function archivedDaysRead(){ 
    try { 
      const data = localStorage.getItem(ARCHIVED_DAYS_KEY);
      if (!data) return [];
      return JSON.parse(data); 
    } catch(e) { 
      console.error('Error reading archived days:', e);
      return []; 
    } 
  }
  
  function archivedDaysWrite(e){ 
    try {
      localStorage.setItem(ARCHIVED_DAYS_KEY, JSON.stringify(e));
    } catch(e) {
      console.error('Error writing archived days:', e);
    }
  }
  
  // Create auto-backup
  function createAutoBackup() {
    try {
      const backup = {
        users: usersRead(),
        expenses: expensesRead(),
        archivedDays: archivedDaysRead(),
        timestamp: new Date().toISOString(),
        version: 'v2'
      };
      localStorage.setItem('expense_Tracker_auto_backup', JSON.stringify(backup));
      localStorage.setItem(LAST_BACKUP_KEY, Date.now().toString());
    } catch(e) {
      console.error('Error creating auto-backup:', e);
    }
  }
  
  // Restore from auto-backup
  function restoreFromBackup() {
    try {
      const backup = localStorage.getItem('expense_Tracker_auto_backup');
      if (!backup) return false;
      
      const data = JSON.parse(backup);
      if (data.version === 'v2') {
        usersWrite(data.users);
        expensesWrite(data.expenses);
        archivedDaysWrite(data.archivedDays);
        return true;
      }
    } catch(e) {
      console.error('Error restoring from backup:', e);
    }
    return false;
  }
  
  // =============================================
  // DAY NAVIGATION SYSTEM
  // =============================================
  
  function updateDayDisplay() {
    const todayString = getDateString();
    const viewingString = getDateString(currentViewingDate);
    
    if (viewingString === todayString) {
      $('currentDayDisplay').textContent = 'Today, ' + formatDateDisplay(viewingString);
      $('formDayDisplay').textContent = 'Today';
      $('listDayDisplay').textContent = 'Today';
      $('nextDayBtn').disabled = true;
      $('nextDayBtn').style.opacity = '0.5';
    } else {
      $('currentDayDisplay').textContent = formatDateDisplay(viewingString);
      $('formDayDisplay').textContent = viewingString;
      $('listDayDisplay').textContent = viewingString;
      $('nextDayBtn').disabled = false;
      $('nextDayBtn').style.opacity = '1';
    }
    
    // Update month display
    $('currentMonthDisplay').textContent = formatMonthDisplay();
    
    // Load expenses for this day
    loadDayExpenses(currentViewingDate);
    
    // Update day stats
    updateDayStats(currentViewingDate);
    
    // Load day history
    loadDayHistory();
  }
  
  function goToPreviousDay() {
    const newDate = new Date(currentViewingDate);
    newDate.setDate(newDate.getDate() - 1);
    currentViewingDate = newDate;
    updateDayDisplay();
  }
  
  function goToNextDay() {
    const newDate = new Date(currentViewingDate);
    newDate.setDate(newDate.getDate() + 1);
    currentViewingDate = newDate;
    updateDayDisplay();
  }
  
  function goToToday() {
    currentViewingDate = new Date();
    updateDayDisplay();
  }
  
  // =============================================
  // ENHANCED EXPENSE MANAGEMENT
  // =============================================
  
  function loadDayExpenses(date) {
    if (!currentUser) return;
    
    try {
      const dateString = getDateString(date);
      const expenses = expensesRead();
      
      // Get expenses for this day for current user
      const dayExpenses = expenses.filter(exp => 
        exp.userId === currentUser.id && exp.date === dateString
      );
      
      // Sort by time (most recent first)
      dayExpenses.sort((a, b) => {
        const timeA = a.time || '00:00';
        const timeB = b.time || '00:00';
        return timeB.localeCompare(timeA);
      });
      
      // Update the list
      updateRecentExpensesList(dayExpenses, dateString);
      
    } catch(e) {
      console.error('Error loading day expenses:', e);
    }
  }
  
  function updateRecentExpensesList(dayExpenses, dateString) {
    try {
      const recentExpensesList = $('recentExpensesList');
      if (!dayExpenses || dayExpenses.length === 0) {
        recentExpensesList.innerHTML = '<p style="color:var(--muted); text-align:center; padding:20px;">No expenses recorded for this day</p>';
        return;
      }
      
      const todayString = getDateString();
      const isToday = dateString === todayString;
      
      recentExpensesList.innerHTML = dayExpenses.map(exp => `
        <div class="expense-item">
          <div>
            <div style="font-weight:600;">${escapeHtml(exp.description || 'No description')}</div>
            <div style="font-size:12px; color:var(--muted); display:flex; gap:10px; align-items:center;">
              <span class="expense-category">${escapeHtml(exp.category || 'Uncategorized')}</span>
              <span>‚Ä¢</span>
              <span>${exp.time || ''}</span>
              ${isToday ? '' : '<span style="color:var(--accent-2); font-weight:500;">(Archived)</span>'}
            </div>
          </div>
          <div class="expense-amount">‡ß≥${parseFloat(exp.amount || 0).toFixed(2)}</div>
        </div>
      `).join('');
    } catch(e) {
      console.error('Error updating recent expenses:', e);
    }
  }
  
  function updateDayStats(date) {
    if (!currentUser) return;
    
    try {
      const dateString = getDateString(date);
      const expenses = expensesRead();
      
      // Get expenses for this day
      const dayExpenses = expenses.filter(exp => 
        exp.userId === currentUser.id && exp.date === dateString
      );
      
      const dayTotal = dayExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
      const dayEntries = dayExpenses.length;
      const dayAvg = dayEntries > 0 ? dayTotal / dayEntries : 0;
      
      // Find top category
      const categoryTotals = {};
      dayExpenses.forEach(exp => {
        const category = exp.category || 'Uncategorized';
        categoryTotals[category] = (categoryTotals[category] || 0) + parseFloat(exp.amount || 0);
      });
      
      let topCategory = '-';
      let maxAmount = 0;
      Object.keys(categoryTotals).forEach(category => {
        if (categoryTotals[category] > maxAmount) {
          maxAmount = categoryTotals[category];
          topCategory = category;
        }
      });
      
      // Update stats
      $('dayTotal').textContent = '‡ß≥' + dayTotal.toFixed(2);
      $('dayEntries').textContent = dayEntries;
      $('dayTopCategory').textContent = topCategory;
      $('dayAvgAmount').textContent = '‡ß≥' + dayAvg.toFixed(2);
      
    } catch(e) {
      console.error('Error updating day stats:', e);
    }
  }
  
  function loadDayHistory() {
    if (!currentUser) return;
    
    try {
      const expenses = expensesRead();
      const archivedDays = archivedDaysRead();
      
      // Get all unique days for this user
      const userExpenses = expenses.filter(exp => exp.userId === currentUser.id);
      const daysMap = {};
      
      userExpenses.forEach(exp => {
        if (exp.date) {
          daysMap[exp.date] = (daysMap[exp.date] || 0) + 1;
        }
      });
      
      // Convert to array and sort by date (newest first)
      const days = Object.keys(daysMap)
        .sort((a, b) => b.localeCompare(a))
        .slice(0, 10); // Show last 10 days
      
      const dayHistoryList = $('dayHistoryList');
      
      if (days.length === 0) {
        dayHistoryList.innerHTML = '<p style="color:var(--muted); text-align:center; padding:20px;">No previous days recorded</p>';
        return;
      }
      
      dayHistoryList.innerHTML = days.map(date => {
        const dayExpenses = userExpenses.filter(exp => exp.date === date);
        const dayTotal = dayExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
        const isArchived = archivedDays.includes(date);
        const todayString = getDateString();
        const isToday = date === todayString;
        
        return `
          <div class="history-day" onclick="viewDay('${date}')">
            <div class="history-day-header">
              <div class="history-day-date">
                ${isToday ? 'Today' : formatDateDisplay(date)}
                ${isArchived ? ' üìÅ' : ''}
              </div>
              <div class="history-day-total">‡ß≥${dayTotal.toFixed(2)}</div>
            </div>
            <div class="history-day-expenses">
              ${dayExpenses.length} expense${dayExpenses.length !== 1 ? 's' : ''} ‚Ä¢ 
              ${isArchived ? 'Archived' : 'Active'}
            </div>
          </div>
        `;
      }).join('');
      
    } catch(e) {
      console.error('Error loading day history:', e);
    }
  }
  
  function viewDay(dateString) {
    const date = new Date(dateString + 'T00:00:00');
    currentViewingDate = date;
    updateDayDisplay();
  }
  
  // =============================================
  // DATA ANALYSIS & CHARTS
  // =============================================
  
  function loadUserExpenses(userId) {
    try {
      const expenses = expensesRead();
      const archivedDays = archivedDaysRead();
      
      // Filter user's expenses
      const userExpenses = expenses.filter(exp => exp.userId === userId);
      
      // Calculate stats for today
      const todayString = getDateString();
      const todayExpenses = userExpenses.filter(exp => exp.date === todayString);
      const todayTotal = todayExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
      
      // Monthly total (current month)
      const currentMonth = getMonthString();
      const monthExpenses = userExpenses.filter(exp => {
        if (!exp.date) return false;
        const expMonth = exp.date.substring(0, 7); // Get YYYY-MM
        return expMonth === currentMonth;
      });
      const monthlyTotal = monthExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
      
      // Calculate average daily spending
      const dates = [...new Set(userExpenses.map(exp => exp.date).filter(Boolean))];
      const totalAmount = userExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
      const avgDaily = dates.length > 0 ? totalAmount / dates.length : 0;
      
      // Profile stats
      const totalSpent = userExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
      
      // Find favorite category
      const categoryTotals = {};
      userExpenses.forEach(exp => {
        const category = exp.category || 'Uncategorized';
        categoryTotals[category] = (categoryTotals[category] || 0) + 1;
      });
      
      let favoriteCategory = '-';
      let maxCount = 0;
      Object.keys(categoryTotals).forEach(category => {
        if (categoryTotals[category] > maxCount) {
          maxCount = categoryTotals[category];
          favoriteCategory = category;
        }
      });
      
      // Update all stats
      $('todayTotal').textContent = '‡ß≥' + todayTotal.toFixed(2);
      $('monthlyTotal').textContent = '‡ß≥' + monthlyTotal.toFixed(2);
      $('totalEntries').textContent = userExpenses.length;
      $('avgDaily').textContent = '‡ß≥' + avgDaily.toFixed(2);
      $('profileTotalExpenses').textContent = userExpenses.length + ' entries';
      $('profileTotalSpent').textContent = '‡ß≥' + totalSpent.toFixed(2);
      $('profileDaysTracked').textContent = dates.length + ' days';
      $('profileFavoriteCategory').textContent = favoriteCategory;
      
      // Update charts
      updateChart(userExpenses, 'weekly');
      updateCategoryChart(userExpenses);
      updateCategorySummary(userExpenses);
      
    } catch(e) {
      console.error('Error loading user expenses:', e);
    }
  }
  
  function updateChart(userExpenses, period = 'weekly') {
    try {
      const ctx = document.getElementById('expenseChart').getContext('2d');
      
      if (expenseChart) {
        expenseChart.destroy();
      }
      
      let labels = [];
      let data = [];
      
      if (period === 'weekly') {
        // Last 7 days
        labels = [];
        data = [];
        
        for (let i = 6; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          const dateStr = getDateString(date);
          const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
          labels.push(dayName);
          
          const dayExpenses = userExpenses.filter(exp => exp.date === dateStr);
          const dayTotal = dayExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
          data.push(dayTotal);
        }
      } else if (period === 'monthly') {
        // Last 30 days
        labels = [];
        data = [];
        
        for (let i = 29; i >= 0; i--) {
          const date = new Date();
          date.setDate(date.getDate() - i);
          const dateStr = getDateString(date);
          const dayNum = date.getDate();
          labels.push(dayNum.toString());
          
          const dayExpenses = userExpenses.filter(exp => exp.date === dateStr);
          const dayTotal = dayExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
          data.push(dayTotal);
        }
      } else if (period === 'yearly') {
        // Last 12 months
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        labels = months;
        data = new Array(12).fill(0);
        
        const currentYear = new Date().getFullYear();
        
        userExpenses.forEach(exp => {
          if (!exp.date) return;
          const expDate = new Date(exp.date);
          if (expDate.getFullYear() === currentYear) {
            const month = expDate.getMonth();
            data[month] += parseFloat(exp.amount || 0);
          }
        });
      }
      
      expenseChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Expenses (‡ß≥)',
            data: data,
            backgroundColor: 'rgba(139, 94, 60, 0.1)',
            borderColor: 'rgba(139, 94, 60, 1)',
            borderWidth: 2,
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '‡ß≥' + value;
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    } catch(e) {
      console.error('Error updating chart:', e);
    }
  }
  
  function updateCategoryChart(userExpenses) {
    try {
      const ctx = document.getElementById('categoryChart').getContext('2d');
      
      if (categoryChart) {
        categoryChart.destroy();
      }
      
      // Get current month expenses
      const currentMonth = getMonthString();
      const monthExpenses = userExpenses.filter(exp => {
        if (!exp.date) return false;
        const expMonth = exp.date.substring(0, 7);
        return expMonth === currentMonth;
      });
      
      // Calculate category totals
      const categoryTotals = {};
      monthExpenses.forEach(exp => {
        const category = exp.category || 'Uncategorized';
        categoryTotals[category] = (categoryTotals[category] || 0) + parseFloat(exp.amount || 0);
      });
      
      // Sort by amount (descending)
      const sortedCategories = Object.keys(categoryTotals).sort((a, b) => categoryTotals[b] - categoryTotals[a]);
      
      const labels = sortedCategories;
      const data = sortedCategories.map(cat => categoryTotals[cat]);
      
      // Generate colors
      const colors = [
        'rgba(139, 94, 60, 0.8)',
        'rgba(199, 154, 106, 0.8)',
        'rgba(224, 106, 74, 0.8)',
        'rgba(90, 161, 114, 0.8)',
        'rgba(120, 107, 96, 0.8)',
        'rgba(247, 236, 221, 0.8)'
      ];
      
      categoryChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Spending by Category (‡ß≥)',
            data: data,
            backgroundColor: labels.map((_, i) => colors[i % colors.length]),
            borderColor: labels.map((_, i) => colors[i % colors.length].replace('0.8', '1')),
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '‡ß≥' + value;
                }
              }
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
      
    } catch(e) {
      console.error('Error updating category chart:', e);
    }
  }
  
  function updateCategorySummary(userExpenses) {
    try {
      // Get current month expenses
      const currentMonth = getMonthString();
      const monthExpenses = userExpenses.filter(exp => {
        if (!exp.date) return false;
        const expMonth = exp.date.substring(0, 7);
        return expMonth === currentMonth;
      });
      
      if (monthExpenses.length === 0) {
        $('categorySummary').innerHTML = '<p style="color:var(--muted); text-align:center; padding:20px;">No expense data available for this month</p>';
        return;
      }
      
      // Calculate category totals and percentages
      const categoryTotals = {};
      const monthTotal = monthExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
      
      monthExpenses.forEach(exp => {
        const category = exp.category || 'Uncategorized';
        categoryTotals[category] = (categoryTotals[category] || 0) + parseFloat(exp.amount || 0);
      });
      
      // Sort by amount (descending)
      const sortedCategories = Object.keys(categoryTotals).sort((a, b) => categoryTotals[b] - categoryTotals[a]);
      
      $('categorySummary').innerHTML = sortedCategories.map(category => {
        const amount = categoryTotals[category];
        const percentage = monthTotal > 0 ? (amount / monthTotal * 100).toFixed(1) : 0;
        const count = monthExpenses.filter(exp => (exp.category || 'Uncategorized') === category).length;
        
        return `
          <div class="category-item">
            <div class="category-name">${escapeHtml(category)}</div>
            <div class="category-amount">‡ß≥${amount.toFixed(2)}</div>
            <div class="category-count">${count} expense${count !== 1 ? 's' : ''} ‚Ä¢ ${percentage}% of total</div>
            <div class="category-percentage">
              <div class="category-fill" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      }).join('');
      
    } catch(e) {
      console.error('Error updating category summary:', e);
    }
  }
  
  // =============================================
  // DATA MANAGEMENT FUNCTIONS
  // =============================================
  
  function exportAllData() {
    try {
      const data = {
        users: usersRead(),
        expenses: expensesRead(),
        archivedDays: archivedDaysRead(),
        exported: new Date().toISOString(),
        version: 'v2'
      };
      
      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      
      const url = URL.createObjectURL(dataBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `expense-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Data exported successfully!');
    } catch(e) {
      console.error('Error exporting data:', e);
      showNotification('Error exporting data', 'error');
    }
  }
  
  function importData(file) {
    try {
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          // Validate data structure
          if (!data.users || !data.expenses || !data.version) {
            throw new Error('Invalid data format');
          }
          
          if (confirm('This will replace all existing data. Are you sure?')) {
            usersWrite(data.users);
            expensesWrite(data.expenses);
            if (data.archivedDays) {
              archivedDaysWrite(data.archivedDays);
            }
            
            // Reload current user data
            if (currentUser) {
              const users = usersRead();
              const user = users.find(u => u.id === currentUser.id);
              if (user) {
                currentUser = user;
                updateDashboard(user);
              }
            }
            
            showNotification('Data imported successfully!');
            closeImport();
          }
        } catch(err) {
          console.error('Error parsing imported data:', err);
          showNotification('Invalid data format', 'error');
        }
      };
      reader.readAsText(file);
    } catch(e) {
      console.error('Error importing data:', e);
      showNotification('Error importing data', 'error');
    }
  }
  
  function clearAllData() {
    if (confirm('‚ö†Ô∏è This will delete ALL data including users, expenses, and settings. This cannot be undone! Are you absolutely sure?')) {
      localStorage.clear();
      showNotification('All data cleared. Page will reload.', 'warning');
      setTimeout(() => {
        location.reload();
      }, 2000);
    }
  }
  
  // =============================================
  // CORE FUNCTIONALITY
  // =============================================
  
  // Check login status
  function checkLoginStatus() {
    try {
      const session = JSON.parse(localStorage.getItem(SESSION_KEY) || 'null');
      if (session && session.userId) {
        const users = usersRead();
        const user = users.find(u => u.id === session.userId);
        if (user) {
          currentUser = user;
          showUserMenu(user);
          return user;
        }
      }
    } catch(e) {
      console.error('Error checking login status:', e);
    }
    return null;
  }
  
  // Show user menu when logged in
  function showUserMenu(user) {
    try {
      $('authButtons').style.display = 'none';
      $('userMenu').style.display = 'flex';
      $('userAvatar').textContent = user.name.charAt(0).toUpperCase();
      $('userAvatar').onclick = () => showDashboard(user);
      $('logoutBtnNav').style.display = 'block';
      
      // Update side menu
      $('menuAuthButtons').style.display = 'none';
      $('menuUserInfo').style.display = 'flex';
      $('menuUserAvatar').textContent = user.name.charAt(0).toUpperCase();
      $('menuUserName').textContent = user.name;
      $('menuUserInfo').onclick = () => {
        closeMenu();
        showDashboard(user);
      };
    } catch(e) {
      console.error('Error showing user menu:', e);
    }
  }
  
  // Show auth buttons when logged out
  function showAuthButtons() {
    try {
      $('authButtons').style.display = 'flex';
      $('userMenu').style.display = 'none';
      $('logoutBtnNav').style.display = 'none';
      
      // Update side menu
      $('menuAuthButtons').style.display = 'flex';
      $('menuUserInfo').style.display = 'none';
      
      // Re-attach event listeners for menu buttons
      document.getElementById('menuLogin').addEventListener('click', ()=>{ closeMenu(); openLogin(); });
      document.getElementById('menuSign').addEventListener('click', ()=>{ closeMenu(); openRegister(); });
    } catch(e) {
      console.error('Error showing auth buttons:', e);
    }
  }
  
  // Show homepage and hide dashboard
  function showHomepage() {
    $('homepageContent').style.display = 'block';
    $('dashboardPage').style.display = 'none';
  }
  
  // Show dashboard and hide homepage
  function showDashboard(user) {
    try {
      $('homepageContent').style.display = 'none';
      $('dashboardPage').style.display = 'block';
      
      // Update dashboard with user info
      updateDashboard(user);
      
      // Initialize day display
      updateDayDisplay();
      
    } catch(e) {
      console.error('Error showing dashboard:', e);
    }
  }
  
  // Update dashboard with user data
  function updateDashboard(user) {
    if (!user) return;
    
    try {
      $('dashboardUserName').textContent = user.name;
      $('profileName').textContent = user.name;
      $('profileEmail').textContent = user.email;
      $('profileAvatar').textContent = user.name.charAt(0).toUpperCase();
      $('profileProfession').textContent = user.profession || 'Not specified';
      $('profileAge').textContent = user.age || '-';
      $('profileCity').textContent = user.city || '-';
      $('profilePhone').textContent = user.phone || '-';
      $('profileJoinDate').textContent = user.created ? new Date(user.created).toLocaleDateString() : 'Recently';
      
      // Load user's expenses
      loadUserExpenses(user.id);
      
    } catch(e) {
      console.error('Error updating dashboard:', e);
    }
  }
  
  // Add expense function
  function addExpense() {
    try {
      if (!currentUser) {
        showNotification('Please login first', 'error');
        return;
      }
      
      const category = $('category').value === 'Other' 
        ? ($('customCategory').value.trim() || 'Other')
        : $('category').value;
      const description = $('description').value.trim();
      const amount = parseFloat($('amount').value);
      const dateString = getDateString(currentViewingDate);
      
      if (!description) {
        showNotification('Please enter a description', 'error');
        $('description').focus();
        return;
      }
      
      if (!amount || amount <= 0 || isNaN(amount)) {
        showNotification('Please enter a valid amount', 'error');
        $('amount').focus();
        return;
      }
      
      const now = new Date();
      const expense = {
        id: Date.now().toString(),
        userId: currentUser.id,
        date: dateString,
        time: now.toTimeString().split(' ')[0].substring(0, 5), // HH:MM format
        category: category,
        description: description,
        amount: amount,
        createdAt: now.toISOString()
      };
      
      const expenses = expensesRead();
      expenses.push(expense);
      expensesWrite(expenses);
      
      // Clear form
      $('description').value = '';
      $('amount').value = '';
      if ($('category').value === 'Other') {
        $('customCategory').value = '';
      }
      $('description').focus();
      
      // Reload expenses
      loadUserExpenses(currentUser.id);
      loadDayExpenses(currentViewingDate);
      updateDayStats(currentViewingDate);
      
      // Show success message
      showNotification('Expense added successfully!');
      
    } catch(e) {
      console.error('Error adding expense:', e);
      showNotification('Error adding expense. Please try again.', 'error');
    }
  }
  
  // Clear day's expenses
  function clearDayExpenses() {
    try {
      if (!currentUser) return;
      
      const dateString = getDateString(currentViewingDate);
      const todayString = getDateString();
      
      // Don't allow clearing today if it's archived
      if (dateString === todayString) {
        const archivedDays = archivedDaysRead();
        if (archivedDays.includes(dateString)) {
          showNotification('Cannot clear expenses for an archived day', 'error');
          return;
        }
      }
      
      if (!confirm(`Are you sure you want to clear all expenses for ${dateString}?`)) {
        return;
      }
      
      const expenses = expensesRead();
      const filteredExpenses = expenses.filter(exp => 
        !(exp.userId === currentUser.id && exp.date === dateString)
      );
      
      expensesWrite(filteredExpenses);
      loadUserExpenses(currentUser.id);
      loadDayExpenses(currentViewingDate);
      updateDayStats(currentViewingDate);
      
      showNotification('Expenses cleared!');
      
    } catch(e) {
      console.error('Error clearing day expenses:', e);
      showNotification('Error clearing expenses. Please try again.', 'error');
    }
  }
  
  // End day function
  function endDay() {
    try {
      if (!currentUser) {
        showNotification('Please login first', 'error');
        return;
      }
      
      const todayString = getDateString();
      const archivedDays = archivedDaysRead();
      
      // Check if today is already archived
      if (archivedDays.includes(todayString)) {
        showNotification('Today is already archived!', 'warning');
        return;
      }
      
      const expenses = expensesRead();
      const todayExpenses = expenses.filter(exp => 
        exp.userId === currentUser.id && exp.date === todayString
      );
      
      if (todayExpenses.length === 0) {
        showNotification('No expenses recorded for today. Add some expenses first!', 'warning');
        return;
      }
      
      const todayTotal = todayExpenses.reduce((sum, exp) => sum + parseFloat(exp.amount || 0), 0);
      
      // Archive today
      archivedDays.push(todayString);
      archivedDaysWrite(archivedDays);
      
      // Create confetti animation
      createConfetti();
      
      // Show success message
      showNotification(`Day archived! You tracked ${todayExpenses.length} expenses totaling ‡ß≥${todayTotal.toFixed(2)}. Great job! üéâ`);
      
      // Reset to today
      goToToday();
      
      // Reload data
      loadUserExpenses(currentUser.id);
      
    } catch(e) {
      console.error('Error ending day:', e);
      showNotification('Error ending day. Please try again.', 'error');
    }
  }
  
  // =============================================
  // UTILITY FUNCTIONS
  // =============================================
  
  function createConfetti() {
    try {
      const colors = ['#8b5e3c', '#c79a6a', '#e06a4a', '#5aa172', '#F7ECDD'];
      
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = '-10px';
        confetti.style.width = Math.random() * 20 + 5 + 'px';
        confetti.style.height = Math.random() * 20 + 5 + 'px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
        confetti.style.animationDelay = Math.random() * 2 + 's';
        
        document.getElementById('confettiContainer').appendChild(confetti);
        
        // Remove after animation
        setTimeout(() => {
          if (confetti.parentNode) {
            confetti.remove();
          }
        }, 5000);
      }
    } catch(e) {
      console.error('Error creating confetti:', e);
    }
  }
  
  // Escape HTML
  function escapeHtml(text) {
    try {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    } catch(e) {
      return text || '';
    }
  }
  
  // Show notification
  function showNotification(message, type = 'success') {
    try {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      
      // Set color based on type
      if (type === 'error') {
        notification.style.background = 'var(--danger)';
      } else if (type === 'warning') {
        notification.style.background = 'var(--accent-2)';
      } else {
        notification.style.background = 'var(--success)';
      }
      
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-out forwards';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 300);
      }, 3000);
    } catch(e) {
      console.error('Error showing notification:', e);
      alert(message);
    }
  }
  
  // =============================================
  // SETUP EVENT LISTENERS
  // =============================================
  
  function setupDashboardTabs() {
    try {
      const tabButtons = document.querySelectorAll('.tab-btn');
      tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          // Remove active class from all tabs
          tabButtons.forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.dashboard-content').forEach(c => c.classList.remove('active'));
          
          // Add active class to clicked tab
          btn.classList.add('active');
          const tabId = btn.dataset.tab + 'Tab';
          $(tabId).classList.add('active');
          
          // Update chart if needed
          if (btn.dataset.tab === 'graphs' && currentUser) {
            const activePeriod = document.querySelector('.chart-tab.active')?.dataset.period || 'weekly';
            const expenses = expensesRead();
            const userExpenses = expenses.filter(exp => exp.userId === currentUser.id);
            updateChart(userExpenses, activePeriod);
            updateCategoryChart(userExpenses);
            updateCategorySummary(userExpenses);
          }
        });
      });
      
      // Chart period tabs
      const chartTabs = document.querySelectorAll('.chart-tab');
      chartTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          chartTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          if (currentUser) {
            const expenses = expensesRead();
            const userExpenses = expenses.filter(exp => exp.userId === currentUser.id);
            updateChart(userExpenses, tab.dataset.period);
          }
        });
      });
    } catch(e) {
      console.error('Error setting up dashboard tabs:', e);
    }
  }
  
  function setupExpenseFunctionality() {
    try {
      // Category change
      $('category').addEventListener('change', (e) => {
        $('customCategoryGroup').style.display = e.target.value === 'Other' ? 'block' : 'none';
      });
      
      // Add expense button
      $('addExpenseBtn').addEventListener('click', addExpense);
      
      // Enter key support
      $('description').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addExpense();
      });
      $('amount').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addExpense();
      });
      $('customCategory').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') addExpense();
      });
      
      // Clear day button
      $('clearDayBtn').addEventListener('click', clearDayExpenses);
      
      // End day button
      $('endDayBtn').addEventListener('click', endDay);
      
      // Day navigation
      $('prevDayBtn').addEventListener('click', goToPreviousDay);
      $('nextDayBtn').addEventListener('click', goToNextDay);
      
      // Data management
      $('exportDataBtn').addEventListener('click', exportAllData);
      $('importDataBtn').addEventListener('click', openImport);
      $('clearAllDataBtn').addEventListener('click', clearAllData);
      $('importSubmit').addEventListener('click', () => {
        const file = $('importFile').files[0];
        if (file) {
          importData(file);
        } else {
          showNotification('Please select a file first', 'error');
        }
      });
      
    } catch(e) {
      console.error('Error setting up expense functionality:', e);
    }
  }
  
  // =============================================
  // AUTHENTICATION HANDLERS
  // =============================================
  
  // Register handler
  $('regSubmit').addEventListener('click', () => {
    try {
      const name = $('reg_name').value.trim();
      const email = $('reg_email').value.trim().toLowerCase();
      const prof = $('reg_prof').value.trim();
      const age = $('reg_age').value.trim();
      const city = $('reg_city').value.trim();
      const phone = $('reg_phone').value.trim();
      const pass = $('reg_pass').value;
      
      if (!name || !email || pass.length < 4) { 
        showNotification('Please fill name, email and a password (at least 4 characters)', 'error');
        return; 
      }
      
      const users = usersRead();
      if (users.find(u => u.email === email)) { 
        showNotification('Email already registered', 'error');
        return; 
      }
      
      const id = Date.now().toString(36);
      const user = { 
        id, 
        name, 
        email, 
        prof, 
        age, 
        city, 
        phone, 
        password: pass, 
        created: new Date().toISOString() 
      };
      
      users.push(user);
      usersWrite(users);
      
      // Auto-login after registration
      localStorage.setItem(SESSION_KEY, JSON.stringify({ userId: id }));
      currentUser = user;
      showUserMenu(user);
      showDashboard(user);
      
      closeRegister();
      showNotification('Account created successfully!');
    } catch(e) {
      console.error('Error during registration:', e);
      showNotification('Error creating account. Please try again.', 'error');
    }
  });

  // Login handler
  $('loginSubmit').addEventListener('click', () => {
    try {
      const identifier = $('loginModalEmail').value.trim().toLowerCase();
      const pass = $('loginModalPass').value;
      
      if (!identifier || !pass) { 
        showNotification('Enter email/username and password', 'error');
        return; 
      }
      
      const users = usersRead();
      const user = users.find(u => (u.email === identifier || u.name.toLowerCase() === identifier) && u.password === pass);
      
      if (!user) { 
        showNotification('User not found or wrong password', 'error');
        return; 
      }
      
      // Save session
      localStorage.setItem(SESSION_KEY, JSON.stringify({ userId: user.id }));
      currentUser = user;
      
      // Update UI
      showUserMenu(user);
      showDashboard(user);
      closeLogin();
      showNotification(`Welcome back, ${user.name}!`);
    } catch(e) {
      console.error('Error during login:', e);
      showNotification('Error logging in. Please try again.', 'error');
    }
  });

  // Logout handler
  $('logoutBtnNav').addEventListener('click', () => {
    try {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem(SESSION_KEY);
        currentUser = null;
        showAuthButtons();
        showHomepage();
        showNotification('Logged out successfully');
      }
    } catch(e) {
      console.error('Error during logout:', e);
      showNotification('Error logging out. Please try again.', 'error');
    }
  });

  // Back to home button
  $('backToHomeBtn').addEventListener('click', showHomepage);

  // =============================================
  // INITIALIZATION
  // =============================================

  // Initialize
  window.addEventListener('DOMContentLoaded', () => {
    try {
      // Try to restore from backup if no data exists
      const users = usersRead();
      if (users.length === 0) {
        restoreFromBackup();
      }
      
      const user = checkLoginStatus();
      if (user) {
        showUserMenu(user);
      } else {
        showAuthButtons();
      }
      
      // Setup dashboard functionality
      setupDashboardTabs();
      setupExpenseFunctionality();
      
      // Check if we should show dashboard from URL
      if (window.location.hash === '#dashboard') {
        const user = checkLoginStatus();
        if (user) {
          showDashboard(user);
        }
      }
      
      // Create initial backup
      createAutoBackup();
      
    } catch(e) {
      console.error('Error during initialization:', e);
    }
  });

  // Close modals on ESC
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') { 
      closeLogin(); 
      closeRegister(); 
      closeImport();
      closeMenu();
    }
  });

  // Close modals when clicking outside
  modalBack.addEventListener('click', (ev) => { if (ev.target === modalBack) closeLogin(); });
  modalBackReg.addEventListener('click', (ev) => { if (ev.target === modalBackReg) closeRegister(); });
  importModalBack.addEventListener('click', (ev) => { if (ev.target === importModalBack) closeImport(); });
</script>
</body>
</html>