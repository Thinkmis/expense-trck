<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Expense Cracker — Soft Beige</title>
<style>
  :root{
    --bg:#f5efe6;         /* page background */
    --card:#fffaf3;       /* card */
    --accent:#8b5e3c;     /* dark brown */
    --accent-2:#c79a6a;   /* light brown */
    --muted:#7a6b60;      /* text muted */
    --danger:#e06a4a;
    --success:#5aa172;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: var(--bg); color:#2f2722; -webkit-font-smoothing:antialiased;
    padding:28px;
  }

  .wrap{max-width:920px;margin:0 auto;display:grid;grid-template-columns:360px 1fr;gap:20px;}
  @media(max-width:880px){ .wrap{grid-template-columns:1fr;padding:12px;} }

  .card{
    background:var(--card); padding:18px;border-radius:12px;box-shadow:0 10px 40px rgba(35,25,18,0.06);
  }
  h1{margin:0 0 6px;font-size:20px;color:var(--accent)}
  p.muted{margin:0;color:var(--muted);font-size:13px}

  /* input row */
  label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
  input[type="text"], input[type="number"], select {
    width:100%; padding:10px 12px; margin-top:6px; border-radius:8px; border:1px solid rgba(120,100,85,0.12);
    background:white; font-size:15px; color:#2f2722;
  }
  .row{display:flex; gap:10px}
  .row > *{flex:1}

  button{
    background:linear-gradient(180deg,var(--accent),var(--accent-2)); color:white; border:none; padding:10px 12px;
    border-radius:10px; cursor:pointer; font-weight:600; box-shadow:0 6px 18px rgba(139,94,60,0.12);
  }
  button.ghost{background:transparent;color:var(--accent); border:1px solid rgba(139,94,60,0.12); box-shadow:none}
  button.danger{background:var(--danger)}
  .small{font-size:13px;padding:8px 10px;border-radius:8px}

  /* expense list */
  .empty{color:var(--muted);padding:14px;border-radius:8px;background:rgba(120,100,85,0.03);text-align:center}
  .expense-list{display:flex;flex-direction:column;gap:10px;margin-top:12px}
  .expense-card{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(180deg,#fff,#fffaf6);border:1px solid rgba(120,100,85,0.04)}
  .left{display:flex;gap:12px;align-items:center}
  .badge{font-size:13px;padding:6px 8px;border-radius:8px;background:rgba(199,154,106,0.12);color:var(--accent);font-weight:600}
  .desc{font-size:14px;color:#2f2722}
  .amt{font-weight:700;color:var(--accent)}
  .trash{background:transparent;border:none;color:var(--danger);cursor:pointer;font-weight:700}

  /* top summary */
  .summary{margin-top:12px;display:flex;justify-content:space-between;align-items:center;gap:8px}
  .summary .box{background:rgba(199,154,106,0.06);padding:10px;border-radius:8px;flex:1;text-align:center}
  .summary strong{display:block;font-size:20px;color:var(--accent)}

  /* animation area */
  .anim-wrap{position:fixed;inset:0;display:flex;justify-content:center;align-items:center;pointer-events:none;z-index:1000}
  .anim-modal{pointer-events:auto;background:linear-gradient(180deg,#fffaf3,#fff6ed);border:1px solid rgba(120,100,85,0.09);padding:22px;border-radius:16px;box-shadow:0 20px 60px rgba(45,30,20,0.12);text-align:center;max-width:420px}
  .check{width:80px;height:80px;border-radius:50%;background:var(--success);display:inline-flex;align-items:center;justify-content:center;color:white;font-size:38px;margin:0 auto 12px;transform:scale(0);animation:pop .45s forwards}
  @keyframes pop{to{transform:scale(1)}}

  .confetti-piece{position:absolute;width:10px;height:16px;border-radius:3px;opacity:0;transform:translateY(-20px) rotate(0deg)}
  /* spawn animations will be set inline */

  .msg{font-size:16px;color:#3e3129; margin-bottom:8px}
  .sub{color:var(--muted);font-size:13px}

  footer.note{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
</style>
</head>
<body>

<div class="wrap" role="main">
  <!-- Left column: add expense -->
  <div class="card">
    <h1>Expense Cracker</h1>
    <p class="muted">Quick daily logging • student-friendly • soft beige theme</p>

    <label for="category">Category</label>
    <select id="category" aria-label="Category">
      <option value="Food">Food</option>
      <option value="Transport">Transport</option>
      <option value="Shopping">Shopping</option>
      <option value="Bills">Bills</option>
      <option value="Medicine">Medicine</option>
      <option value="Fun">Fun</option>
      <option value="Other">Other (custom)</option>
    </select>

    <div id="customWrap" style="display:none">
      <label for="custom">Custom category</label>
      <input id="custom" type="text" placeholder="Type custom category name">
    </div>

    <label for="desc">Description</label>
    <input id="desc" type="text" placeholder="e.g., lunch at canteen, bus fare">

    <label for="amt">Amount (৳)</label>
    <input id="amt" type="number" placeholder="0.00" min="0" step="0.01">

    <div style="display:flex;gap:10px;margin-top:12px">
      <button id="addBtn">Add Expense</button>
      <button id="clearToday" class="ghost small">Clear Today</button>
    </div>

    <div class="summary" aria-live="polite">
      <div class="box">
        <small class="muted">Today total</small>
        <strong id="total">৳0.00</strong>
      </div>
      <div class="box">
        <small class="muted">Entries</small>
        <strong id="count">0</strong>
      </div>
    </div>

    <div style="margin-top:14px">
      <button id="endDay" style="width:100%; margin-top:12px; background:linear-gradient(180deg,#c79a6a,#8b5e3c);">End of Day — Done ✔</button>
    </div>

    <footer class="note">Tip: press <strong>Enter</strong> in description or amount to add faster.</footer>
  </div>

  <!-- Right column: list -->
  <div class="card">
    <h3>Today's Expenses</h3>
    <div id="listWrap">
      <div class="empty" id="emptyMsg">No expenses yet. Add one — it's quick.</div>
      <div class="expense-list" id="list"></div>
    </div>

    <div style="margin-top:12px">
      <label for="viewRange">Show last</label>
      <select id="viewRange" style="width:120px;margin-top:6px">
        <option value="1">Today</option>
        <option value="7">7 days</option>
        <option value="30" selected>30 days</option>
      </select>
    </div>
  </div>
</div>

<!-- animation overlay (hidden until end day) -->
<div class="anim-wrap" id="animWrap" style="display:none">
  <!-- confetti pieces appended dynamically -->
  <div class="anim-modal" role="dialog" aria-modal="true" aria-labelledby="animTitle">
    <div class="check" aria-hidden="true">✓</div>
    <div class="msg" id="animTitle">You're doing great — nice work today.</div>
    <div class="sub" id="animSub">Small steps add up. Keep it steady.</div>
    <div style="margin-top:12px">
      <button id="animClose" class="ghost">Close</button>
      <button id="animSave" style="margin-left:8px">Keep Entries</button>
    </div>
  </div>
</div>

<script>
(function(){
  // Elements
  const category = document.getElementById('category');
  const customWrap = document.getElementById('customWrap');
  const custom = document.getElementById('custom');
  const desc = document.getElementById('desc');
  const amt = document.getElementById('amt');
  const addBtn = document.getElementById('addBtn');
  const clearToday = document.getElementById('clearToday');
  const endDay = document.getElementById('endDay');
  const list = document.getElementById('list');
  const emptyMsg = document.getElementById('emptyMsg');
  const totalEl = document.getElementById('total');
  const countEl = document.getElementById('count');
  const animWrap = document.getElementById('animWrap');
  const animClose = document.getElementById('animClose');
  const animSave = document.getElementById('animSave');
  const viewRange = document.getElementById('viewRange');

  // Storage key
  const KEY = 'ec_expenses_v1';

  // Load expenses (array of {id, date, category, desc, amt})
  let expenses = JSON.parse(localStorage.getItem(KEY) || '[]');

  // Helpers
  function todayStr(date = new Date()){
    const y = date.getFullYear(), m = String(date.getMonth()+1).padStart(2,'0'), d = String(date.getDate()).padStart(2,'0');
    return `${y}-${m}-${d}`;
  }

  function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,6); }

  function save(){ localStorage.setItem(KEY, JSON.stringify(expenses)); }

  function formatAmt(n){ return '৳' + parseFloat(n).toFixed(2); }

  // Add expense
  function addExpense(){
    const cat = (category.value === 'Other') ? (custom.value.trim() || 'Other') : category.value;
    const d = desc.value.trim() || '(no note)';
    const a = parseFloat(amt.value);
    if (!a || a <= 0) { alert('Enter a valid amount'); amt.focus(); return; }
    const item = { id: uid(), date: todayStr(), category: cat, desc: d, amt: parseFloat(a) };
    expenses.push(item);
    save();
    render();
    // reset inputs quickly
    desc.value = '';
    amt.value = '';
    if (category.value === 'Other') custom.value = '';
    desc.focus();
  }

  // Delete
  function removeExpense(id){
    if (!confirm('Delete this entry?')) return;
    expenses = expenses.filter(e => e.id !== id);
    save();
    render();
  }

  // Clear today
  function clearTodayFn(){
    if (!confirm('Clear all entries for today?')) return;
    const t = todayStr();
    expenses = expenses.filter(e => e.date !== t);
    save();
    render();
  }

  // Render list based on viewRange
  function render(){
    const range = parseInt(viewRange.value || 1, 10);
    const cutoff = new Date(); cutoff.setDate(cutoff.getDate() - (range-1));
    const cutoffStr = todayStr(cutoff);
    const show = expenses.filter(e => e.date >= cutoffStr).sort((a,b)=> b.date.localeCompare(a.date) || b.id.localeCompare(a.id));
    list.innerHTML = '';
    if (!show.length) { emptyMsg.style.display = 'block'; } else { emptyMsg.style.display = 'none'; }
    let total = 0;
    show.forEach(e => {
      total += Number(e.amt);
      const card = document.createElement('div');
      card.className = 'expense-card';
      card.innerHTML = `
        <div class="left">
          <div class="badge">${escapeHtml(e.category)}</div>
          <div>
            <div class="desc">${escapeHtml(e.desc)}</div>
            <div style="font-size:12px;color:var(--muted)">${e.date}</div>
          </div>
        </div>
        <div style="text-align:right">
          <div class="amt">${formatAmt(e.amt)}</div>
          <button class="trash" title="Delete" data-id="${e.id}">✕</button>
        </div>
      `;
      list.appendChild(card);
    });
    // attach delete handlers
    list.querySelectorAll('.trash').forEach(btn => {
      btn.addEventListener('click', ()=> removeExpense(btn.dataset.id));
    });
    totalEl.textContent = formatAmt(total);
    countEl.textContent = show.length;
  }

  // Escape for safety when injecting text
  function escapeHtml(s){
    return s.replace(/[&<>"']/g, function(m){
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
    });
  }

  // End day animation + message
  const messages = [
    "Nice! You handled your money responsibly today — your future self will thank you.",
    "You showed up today. Small steps stack up into big wins. Proud of you!",
    "Good job — tracking this is already progress. Keep breathing and keep going.",
    "Today you made choices. That's discipline. One day at a time.",
    "You did the important thing today: attention. Keep building the habit."
  ];
  function showEndDay(){
    // show overlay
    animWrap.style.display = 'flex';
    // set message
    document.getElementById('animTitle').textContent = messages[Math.floor(Math.random()*messages.length)];
    document.getElementById('animSub').textContent = 'Tip: Keep entries — you can clear them later.';
    spawnConfetti(30);
    // pointer events handled by modal buttons
  }

  function closeAnim(){
    animWrap.style.display = 'none';
    // remove confetti pieces
    document.querySelectorAll('.confetti-piece').forEach(n => n.remove());
  }

  // generate confetti pieces with animation
  function spawnConfetti(n){
    const colors = ['#c79a6a','#8b5e3c','#f2d7b2','#d3b89a','#e6cdb3'];
    for (let i=0;i<n;i++){
      const el = document.createElement('div');
      el.className = 'confetti-piece';
      el.style.background = colors[Math.floor(Math.random()*colors.length)];
      // random start x/y
      el.style.left = (20 + Math.random()*60) + '%';
      el.style.top = (20 + Math.random()*20) + '%';
      el.style.transform = `translateY(-10px) rotate(${Math.random()*360}deg)`;
      document.getElementById('animWrap').appendChild(el);
      // animate: fall and fade
      const dur = 1400 + Math.random()*800;
      el.animate([
        { transform: `translateY(-30px) rotate(${Math.random()*360}deg)`, opacity:1 },
        { transform: `translateY(${120 + Math.random()*120}px) rotate(${Math.random()*720}deg)`, opacity:0 }
      ], { duration: dur, easing:'cubic-bezier(.2,.8,.2,1)'});
      // remove after
      setTimeout(()=> el.remove(), dur+100);
    }
  }

  // When animSave clicked -> keep entries and close
  function animSaveFn(){ closeAnim(); }

  // Event wiring
  category.addEventListener('change', ()=> {
    customWrap.style.display = (category.value === 'Other') ? 'block' : 'none';
    if (category.value !== 'Other') custom.value = '';
  });

  addBtn.addEventListener('click', addExpense);
  clearToday.addEventListener('click', clearTodayFn);
  endDay.addEventListener('click', showEndDay);
  animClose.addEventListener('click', closeAnim);
  animSave.addEventListener('click', animSaveFn);

  // Enter key support on desc, amt, custom
  [desc, amt, custom].forEach(el => {
    el.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); addExpense(); }
    });
  });

  // viewRange change re-render
  viewRange.addEventListener('change', render);

  // initial render
  render();

  // For convenience: keep focus on description
  desc.focus();

  // expose remove (optional)
  window._ec = { addExpense };

})();
</script>
</body>
</html>
